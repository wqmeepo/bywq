{% extends "common/common_sidebar.html" %}
{% block content_sidebar %}
    <head>
        <link href="{{ url_for('static',filename='home/css/common.css') }}" rel="stylesheet">
        <style>
            .modal-dialog {
                max-width: 800px;
            }
        </style>
    </head>
    <body>

    <div class="container-fluid mt-3">
        <div class="mb-3">
            <p class="lead container col-12">数据库信息搜索</p>
        </div>
        <!-- 搜索 -->
        <form method="post" class="col-auto form-inline my-2 my-lg-0 justify-content-center">
            <select id='select_sys' name="select_sys" class="custom-select"
                    aria-label=".form-select-lg" required>
                <option selected="">选择系统</option>
                {% for sys in g.bs %}
                    <option value={{ sys.sys_no }}>{{ sys.sys_name }}</option>
                {% endfor %}
            </select>
            {{ form.select_type }}
            {{ form.keyword }}
            {{ form.csrf_token }}
            {{ form.submit }}
        </form>
        <br>
        <!-- 展示搜索表格结果 -->
        <table class="table table-striped table-hover table-bordered table-sm">
            <thead>
            <tr>
                <th scope="col">序号</th>
                <th scope="col">系统名称</th>
                <th scope="col">表名</th>
                <th scope="col">表描述</th>
                <th scope="col">字段名</th>
                <th scope="col">字段描述</th>
                <th scope="col">所属子系统</th>
                <th scope="col">所属数据库</th>
            </tr>
            </thead>
            {% if g.select_type == 1 %}
                <tbody>
                {% for item in g.query_result_table %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ g.sys_name.sys_name }}</td>
                        <td>{{ item.table_name }}</td>
                        <td>{{ item.table_describe }}</td>
                        <td><a id="modal-1" href="#modal-container-1" role="button"
                               data-toggle="modal" onclick="getDictionary($(this).text())">{{ item.field_name }}</a>
                        </td>
                        <td>{{ item.field_describe }}</td>
                        <td>{{ item.sheet_name }}</td>
                        <td>{{ item.db_name }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            {% endif %}

            {% if g.select_type == 2 %}
                <tbody>
                {% for item in g.query_result_field %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ g.sys_name.sys_name }}</td>
                        <td>{{ item.table_name }}</td>
                        <td>{{ item.table_describe }}</td>
                        <td><a id="modal-1" href="#modal-container-1" role="button"
                               data-toggle="modal" onclick="getDictionary($(this).text())">{{ item.field_name }}</a>
                        </td>
                        <td>{{ item.field_describe }}</td>
                        <td>{{ item.sheet_name }}</td>
                        <td>{{ item.db_name }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            {% endif %}
        </table>
        <div class="modal fade" id="modal-container-1" role="dialog" aria-labelledby="myModalLabel"
             aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title" id="myModalLabel">
                            字段数据字典信息
                        </h4>
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    </div>
                    <div class="modal-body">

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        function getDictionary(field_name) {
            $(".modal-body").load("/bs/querydictionary/" + field_name)
        }
    </script>
    </body>

{% endblock %}
{% extends "common/common.html" %}
{% block content %}
    <head>
        <link href="{{ url_for('static',filename='home/css/common.css') }}" rel="stylesheet">
        <style>
            .modal-dialog {
                max-width: max-content;
            }

            .modal-content {
                width: auto;
            }
        </style>
    </head>
    <body>

    <div class="container-fluid mt-3">
        <div class="position-relative overflow-hidden p-3 p-md-3 m-md-4 text-center bg-light">
            <div class="col-md-5 p-lg-3 mx-auto my-5">
                <h1 class="display-4 fw-normal">其他系统数据库信息检索</h1>
                <p class="lead fw-normal">本界面提供除UF20外其他系统表结构信息查询,目前收录表 {{ total_tabel_num }} 张，以下为支持查询的系统：
                    {% for sys in g.bs %}
                        <p class="lead fw-normal text-info text-small"> {{ sys.sys_name }} </p>
                    {% endfor %}
                </p>
            </div>
            <div class="product-device shadow-sm d-none d-md-block"></div>
            <div class="product-device product-device-2 shadow-sm d-none d-md-block"></div>
        </div>
        <!-- 搜索 -->
        <form method="post" class="col-auto form-inline my-2 my-lg-0 justify-content-center">
            <select id='select_sys' name="select_sys" class="custom-select"
                    aria-label=".form-select-lg" required>
                <option selected="">选择系统</option>
                {% for sys in g.bs %}
                    <option value={{ sys.sys_no }}>{{ sys.sys_name }}</option>
                {% endfor %}
            </select>
            {{ form.select_type }}
            {{ form.keyword }}
            {{ form.csrf_token }}
            {{ form.submit }}
        </form>
        <br>
        <!-- 展示搜索表格结果 -->
        {% if sys_name == 'unsearch' %}
            <p class="text-center text-info">暂无搜索结果</p>
        {% else %}
            <table class="table table-striped table-hover table-bordered table-sm">
                <thead>
                <tr>
                    <th scope="col">序号</th>
                    <th scope="col">系统名</th>
                    <th scope="col">表名</th>
                    <th scope="col">表描述</th>
                    <th scope="col">字段名</th>
                    <th scope="col">字段描述</th>
                    <th scope="col">业务系统</th>
                    <th scope="col">DB用户</th>
                    <th scope="col">备注</th>
                </tr>
                </thead>
                <tbody>
                {% for item in g.query_result %}
                    <tr class="text-small">
                        <td>{{ loop.index }}</td>
                        <td>{{ g.sys.sys_name }}</td>
                        <td>{{ item.table_name }}</td>
                        {% if item.table_describe|length > 35 %}
                            <td>
                                <a class="btn btn-sm btn-secondary" data-toggle="popover" title="表描述"
                                   data-content="{{ item.table_describe }}">查看详情
                                </a>
                            </td>
                        {% else %}
                            <td>{{ item.table_describe }}</td>
                        {% endif %}
                        <td>{{ item.field_name }}</td>
                        {% if item.field_describe|length > 35 %}
                            <td>
                                <a class="btn btn-sm btn-secondary" data-toggle="popover" title="表描述"
                                   data-content="{{ item.field_describe }}">查看详情
                                </a>
                            </td>
                        {% else %}
                            <td>{{ item.field_describe }}</td>
                        {% endif %}
                        <td>{{ item.busin_sys }}</td>
                        <td>{{ item.db_user_name }}</td>
                        {% if item.remark|length > 35 %}
                            <td>
                                <a class="btn btn-sm btn-secondary" data-toggle="popover" title="表描述"
                                   data-content="{{ item.remark }}">查看详情
                                </a>
                            </td>
                        {% else %}
                            <td>{{ item.remark }}</td>
                        {% endif %}
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% endif %}
    </div>
    <script type="text/javascript">
        $(function () {
            $('[data-toggle="popover"]').popover({
                placement: 'top'
            })
        })
    </script>
    </body>

{% endblock %}